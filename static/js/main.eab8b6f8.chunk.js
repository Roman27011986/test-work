(this["webpackJsonptest-work-front-end"]=this["webpackJsonptest-work-front-end"]||[]).push([[0],{11:function(e,t,a){e.exports={loginForm:"LoginPage_loginForm__QOrFN",btnBox:"LoginPage_btnBox__1eAWJ"}},31:function(e,t,a){},76:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a(23),o=a.n(n),s=a(26),c=(a(31),a(32),a(8)),i=a(3),u=a.n(i),l=a(7),p=a(6),g=a.n(p);g.a.defaults.baseURL="http://142.93.134.108:1111",g.a.interceptors.request.use(function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("token is valid"!==localStorage.getItem("tokenIsValid")){e.next=3;break}return t.headers.Authorization="Bearer ".concat(localStorage.getItem("access_token")),e.abrupt("return",t);case 3:return t.headers.Authorization="Bearer ".concat(localStorage.getItem("refresh_token")),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),g.a.interceptors.response.use(function(){var e=Object(l.a)(u.a.mark((function e(t){var a,r,n,o,s,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.setItem("tokenIsValid",null===t||void 0===t||null===(a=t.data)||void 0===a||null===(r=a.body)||void 0===r?void 0:r.message),"token expired"!==t.data.body.message){e.next=19;break}return e.prev=2,e.next=5,g.a.post("/refresh");case 5:return n=e.sent,o=n.data.body,s=o.access_token,c=o.refresh_token,localStorage.setItem("access_token",s),localStorage.setItem("refresh_token",c),localStorage.setItem("tokenIsValid","token is valid"),e.next=14,g.a.get("/me");case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),console.log(e.t0);case 19:return e.abrupt("return",t);case 20:case"end":return e.stop()}}),e,null,[[2,16]])})));return function(t){return e.apply(this,arguments)}}());var b=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.a.get("/me");case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log(e.t0);case 8:case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}(),d=function(){var e=Object(l.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.a.post("/sign_up",t);case 3:return a=e.sent,localStorage.setItem("isLogin",!0),e.abrupt("return",a);case 8:e.prev=8,e.t0=e.catch(0),localStorage.setItem("isLogin",!1);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=Object(l.a)(u.a.mark((function e(t){var a,r,n,o,s,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.email,r=t.password,e.prev=1,e.next=4,g.a.post("/login?email=".concat(a,"&password=").concat(r));case 4:n=e.sent,o=n.data.body,s=o.access_token,c=o.refresh_token,s&&c&&(localStorage.setItem("access_token",s),localStorage.setItem("refresh_token",c),localStorage.setItem("tokenIsValid","token is valid"),localStorage.setItem("isLogin",!0)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),localStorage.setItem("isLogin",!1);case 14:case 15:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}(),m=a(11),h=a.n(m),v=a(2);function j(e){var t=e.toggleLogin,a=e.toggleLoading,n=Object(r.useState)(""),o=Object(c.a)(n,2),s=o[0],i=o[1],p=Object(r.useState)(""),g=Object(c.a)(p,2),b=g[0],m=g[1],j=function(e){var t=e.target,a=t.name,r=t.value;switch(a){case"email":i(r);break;case"password":m(r);break;default:console.log("error from LoginPage")}},k=function(){var e=Object(l.a)(u.a.mark((function e(r){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.preventDefault(),n={email:s,password:b},a(!0),e.t0=r.nativeEvent.submitter.name,e.next="Sign up"===e.t0?6:"Login"===e.t0?9:13;break;case 6:return e.next=8,d(n);case 8:return e.abrupt("break",14);case 9:return e.next=11,f(n);case 11:return t(),e.abrupt("break",14);case 13:return e.abrupt("break",14);case 14:a(!1),i(""),m("");case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(v.jsxs)("form",{className:h.a.loginForm,onSubmit:k,children:[Object(v.jsx)("input",{type:"email",placeholder:"email",value:s,required:!0,name:"email",onChange:j}),Object(v.jsx)("input",{type:"password",placeholder:"password",value:b,required:!0,name:"password",onChange:j}),Object(v.jsxs)("div",{className:h.a.btnBox,children:[Object(v.jsx)("button",{type:"submit",name:"Sign up",children:"Sign up"}),Object(v.jsx)("button",{type:"submit",name:"Login",children:"Login"})]})]})}function k(){return Object(r.useEffect)((function(){b()}),[]),Object(v.jsx)("div",{style:{margin:"auto",width:200},children:"Token is valid"})}var x=a(24),O=a.n(x);var S=function(){var e=Object(r.useState)(JSON.parse(localStorage.getItem("isLogin"))),t=Object(c.a)(e,2),a=t[0],n=t[1],o=Object(r.useState)(!1),s=Object(c.a)(o,2),i=s[0],u=s[1];return Object(v.jsxs)(v.Fragment,{children:[a?Object(v.jsx)(k,{}):Object(v.jsx)(j,{toggleLogin:function(){n(JSON.parse(localStorage.getItem("isLogin")))},toggleLoading:function(e){u(e)}}),i&&Object(v.jsx)(O.a,{type:"Puff",color:"#00BFFF",height:100,width:100,timeout:0})]})};o.a.render(Object(v.jsx)(r.StrictMode,{children:Object(v.jsx)(s.a,{children:Object(v.jsx)(S,{})})}),document.getElementById("root"))}},[[76,1,2]]]);
//# sourceMappingURL=main.eab8b6f8.chunk.js.map